<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Calendar - Multi-Country View</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --color-de: #AEC6E4; /* Medium Blue */
            --color-pl: #FFB3BA; /* Light Red/Pink */
            --color-es: #FFECB3; /* Light Gold/Yellow */
                       --color-gb: #B3D9FF; /* Light Sky Blue */
            --color-cn: #FFB3FF; /* Light Magenta */
            --color-it: #B3FFD9; /* Light Mint Green */
            --color-fr: #D9B3FF; /* Light Violet */
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
            min-height: 100vh;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #64748b;
            font-size: 1rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
            justify-content: center;
        }

        .select-wrapper {
            position: relative;
        }

        select {
            padding: 14px 50px 14px 20px;  /* —É–≤–µ–ª–∏—á—å—Ç–µ padding */
            min-height: 45px;              /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            min-width: 100px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            font-weight: 500;
            text-align: center;
        }

        select:hover {
            border-color: #cbd5e1;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .select-wrapper::after {
            content: '‚ñº';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #64748b;
            font-size: 0.9rem;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: white;
            color: #475569;
            border: 2px solid #e2e8f0;
        }

        .country-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .chip:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .chip-close {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .chip-close:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .calendar-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .month-block {
            background: #fafafa;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .month-header {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: #334155;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 4px;
        }

        .weekday {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            padding: 5px;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            border: 2px solid transparent;
            background: white;
        }

        .day-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        .day-cell.empty {
            background: transparent;
            cursor: default;
        }

        .day-cell.empty:hover {
            transform: none;
            box-shadow: none;
        }

        .day-cell.has-holiday {
            font-weight: 600;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            padding: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
        }

        .modal-close {
            background: #f1f5f9;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: #64748b;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #e2e8f0;
            color: #1e293b;
        }

        .holiday-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border: 2px solid rgba(0, 0, 0, 0.1);
        }

        .holiday-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .holiday-local {
            font-size: 0.9rem;
            color: #64748b;
        }

        .list-view-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            font-size: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            transition: background-color 0.2s ease;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:hover {
            background-color: #f8fafc;
        }

        .list-item-info {
            display: flex;
            flex-direction: column;
        }

        .list-item-date {
            font-weight: 500;
            color: #475569;
        }

        .list-item-country {
            font-size: 0.9rem;
            color: #64748b;
        }

        .country-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 10px;
            z-index: 100;
            width: 250px;
            border: 1px solid #e2e8f0;
            animation: fadeIn 0.2s ease;
        }

        .country-dropdown-header {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            margin-bottom: 5px;
        }

        .country-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .country-dropdown-item:hover {
            background-color: #f8fafc;
        }

        .country-dropdown-item input {
            margin-right: 10px;
        }

        /* New UX/UI Improvements */

        /* Legend */
        .legend-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .legend-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #334155;
            margin-bottom: 15px;
            text-align: center;
        }

        .legend-grid {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 10px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 10px;
            transition: all 0.2s ease;
            background: #f8fafc;
            white-space: nowrap;
            min-width: fit-content;
        }

        .legend-item:hover {
            background: #f1f5f9;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .legend-flag {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .legend-name {
            font-size: 0.9rem;
            font-weight: 500;
            color: #475569;
        }

        /* Statistics Panel */
        .stats-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .stats-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #334155;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-total {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            text-align: center;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background: #f8fafc;
            transition: all 0.2s ease;
        }

        .stats-item:hover {
            background: #f1f5f9;
            transform: scale(1.02);
        }

        .stats-country {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stats-count {
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 12px;
            background: white;
            color: #667eea;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #334155;
        }

        .empty-state-text {
            font-size: 1rem;
            margin-bottom: 30px;
        }

        /* Weekend highlighting */
        .day-cell.weekend {
            background: #f8fafc;
        }

        .day-cell.weekend.has-holiday {
            background: inherit;
        }

        /* Current day indicator */
        .day-cell.today {
            border: 2px solid #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(102, 126, 234, 0.1);
            }
        }

        /* Holiday counter in chips */
        .chip-counter {
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Dark theme */
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
        }

        body.dark-theme .header h1 {
            background: linear-gradient(135deg, #00d4ff 0%, #667eea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-theme .header p {
            color: #94a3b8;
        }

        body.dark-theme .calendar-container,
        body.dark-theme .legend-container,
        body.dark-theme .stats-container,
        body.dark-theme .list-view-container {
            background: #16213e;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        body.dark-theme .month-block {
            background: #0f1729;
        }

        body.dark-theme .month-header {
            color: #e0e0e0;
            border-bottom-color: #2d3748;
        }

        body.dark-theme .weekday {
            color: #94a3b8;
        }

        body.dark-theme .day-cell {
            background: #1a2332;
            color: #e0e0e0;
        }

        body.dark-theme .day-cell.weekend {
            background: #0f1729;
        }

        body.dark-theme .modal {
            background: #16213e;
            color: #e0e0e0;
        }

        body.dark-theme .modal-title {
            color: #e0e0e0;
        }

        body.dark-theme .modal-close {
            background: #0f1729;
            color: #94a3b8;
        }

        body.dark-theme .modal-close:hover {
            background: #1a2332;
            color: #e0e0e0;
        }

        body.dark-theme .holiday-item {
            background: #0f1729;
            border-color: #2d3748;
        }

        body.dark-theme .search-box,
        body.dark-theme select {
            background: #0f1729;
            color: #e0e0e0;
            border-color: #2d3748;
        }

        body.dark-theme .list-item {
            border-bottom-color: #2d3748;
        }

        body.dark-theme .list-item:hover {
            background-color: #0f1729;
        }

        body.dark-theme .legend-item:hover,
        body.dark-theme .stats-item {
            background: #0f1729;
        }

        body.dark-theme .stats-item:hover {
            background: #1a2332;
        }

        body.dark-theme .stats-count {
            background: #0f1729;
        }

        body.dark-theme .empty-state-title {
            color: #e0e0e0;
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(20deg);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        /* Improved animations */
        .month-block {
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .calendar-grid .month-block:nth-child(1) { animation-delay: 0.05s; }
        .calendar-grid .month-block:nth-child(2) { animation-delay: 0.1s; }
        .calendar-grid .month-block:nth-child(3) { animation-delay: 0.15s; }
        .calendar-grid .month-block:nth-child(4) { animation-delay: 0.2s; }
        .calendar-grid .month-block:nth-child(5) { animation-delay: 0.25s; }
        .calendar-grid .month-block:nth-child(6) { animation-delay: 0.3s; }
        .calendar-grid .month-block:nth-child(7) { animation-delay: 0.35s; }
        .calendar-grid .month-block:nth-child(8) { animation-delay: 0.4s; }
        .calendar-grid .month-block:nth-child(9) { animation-delay: 0.45s; }
        .calendar-grid .month-block:nth-child(10) { animation-delay: 0.5s; }
        .calendar-grid .month-block:nth-child(11) { animation-delay: 0.55s; }
        .calendar-grid .month-block:nth-child(12) { animation-delay: 0.6s; }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: 1fr;
            }

            .legend-grid {
                flex-wrap: wrap;
                justify-content: center;
            }

            .legend-item {
                min-width: auto;
            }

            .header h1 {
                font-size: 2rem;
            }

            .theme-toggle {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }

            .bitrix-float-button {
                bottom: 90px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            .controls {
                flex-direction: column;
            }

            .modal,
            .bitrix-modal {
                max-width: 90%;
                padding: 20px;
            }

            .bitrix-actions {
                flex-direction: column;
            }

            .bitrix-actions button {
                width: 100%;
            }
        }

        /* List grouping */
        .list-group {
            margin-bottom: 30px;
        }

        .list-group-header {
            font-size: 1.2rem;
            font-weight: 600;
            color: #334155;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.dark-theme .list-group-header {
            background: #0f1729;
            color: #e0e0e0;
        }

        .list-group-countries {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .list-group-country-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        body.dark-theme .list-group-country-badge {
            background: #1a2332;
        }

        /* Bitrix24 Integration */
        .bitrix-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            animation: fadeIn 0.3s ease;
            padding: 20px;
        }

        .bitrix-modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        body.dark-theme .bitrix-modal {
            background: #16213e;
        }

        .bitrix-float-button {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 998;
        }

        .bitrix-float-button:hover {
            transform: scale(1.1) rotate(-10deg);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.6);
        }

        .bitrix-float-button .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 3px 7px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        .bitrix-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        body.dark-theme .bitrix-header {
            border-bottom-color: #2d3748;
        }

        .bitrix-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-theme .bitrix-title {
            color: #e0e0e0;
        }

        .bitrix-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bitrix-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bitrix-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #475569;
        }

        body.dark-theme .bitrix-label {
            color: #94a3b8;
        }

        .bitrix-input {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        body.dark-theme .bitrix-input {
            background: #0f1729;
            color: #e0e0e0;
            border-color: #2d3748;
        }

        .bitrix-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .bitrix-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .bitrix-upcoming-holidays {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        body.dark-theme .bitrix-upcoming-holidays {
            background: #0f1729;
        }

        .bitrix-upcoming-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #334155;
            margin-bottom: 10px;
        }

        body.dark-theme .bitrix-upcoming-title {
            color: #e0e0e0;
        }

        .bitrix-holiday-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-radius: 6px;
            background: white;
            margin-bottom: 6px;
        }

        body.dark-theme .bitrix-holiday-item {
            background: #1a2332;
        }

        .bitrix-holiday-info {
            display: flex;
            flex-direction: column;
        }

        .bitrix-holiday-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .bitrix-holiday-date {
            font-size: 0.8rem;
            color: #64748b;
        }

        .bitrix-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            background: #fef3c7;
            color: #92400e;
        }

        .bitrix-badge.warning {
            background: #fee2e2;
            color: #991b1b;
        }

        .bitrix-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .bitrix-notification {
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .bitrix-notification.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .bitrix-notification.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .bitrix-notification.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        body.dark-theme .bitrix-notification.success {
            background: #064e3b;
            color: #6ee7b7;
        }

        body.dark-theme .bitrix-notification.error {
            background: #7f1d1d;
            color: #fca5a5;
        }

        body.dark-theme .bitrix-notification.info {
            background: #1e3a8a;
            color: #93c5fd;
        }

        /* Bitrix24 User Chips */
        .bitrix-users-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            min-height: 40px;
            padding: 8px;
            background: #f8fafc;
            border-radius: 8px;
        }

        body.dark-theme .bitrix-users-chips {
            background: #0f1729;
        }

        .bitrix-user-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 500;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            transition: all 0.2s ease;
            animation: chipIn 0.2s ease;
        }

        @keyframes chipIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .bitrix-user-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .bitrix-user-chip-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            color: white;
        }

        .bitrix-user-chip-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .bitrix-users-empty {
            color: #94a3b8;
            font-size: 0.85rem;
            padding: 8px;
        }

        .bitrix-users-count {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 5px;
        }

        body.dark-theme .bitrix-users-count {
            color: #94a3b8;
        }

        .bitrix-input-with-button {
            display: flex;
            gap: 8px;
        }

        .bitrix-input-with-button input {
            flex: 1;
        }

        .bitrix-add-button {
            padding: 10px 16px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .bitrix-add-button:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .bitrix-add-button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }

        body.dark-theme .bitrix-add-button:disabled {
            background: #475569;
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useCallback, useEffect } = React;

        // Localization
        const translations = {
            en: {
                title: 'Holiday Calendar',
                subtitle: 'Explore public holidays across 7 countries',
                selectYear: 'Select year',
                selectCountries: 'Select Countries',
                selectAll: '‚úì Select All',
                clear: '‚úó Clear',
                calendarView: 'Calendar View',
                listView: 'List View',
                searchPlaceholder: 'Search holidays...',
                close: 'Close',
                legend: 'Country Legend',
                statistics: 'Holiday Statistics',
                totalHolidays: 'Total holidays',
                days: 'days',
                emptyStateTitle: 'No countries selected',
                emptyStateText: 'Please select countries above to view their public holidays',
                bitrixTitle: 'Bitrix24 Integration',
                bitrixWebhook: 'Bitrix24 Webhook URL',
                bitrixWebhookPlaceholder: 'https://your-domain.bitrix24.com/rest/1/xxxxx/',
                bitrixUsers: 'User IDs (comma-separated)',
                bitrixUsersPlaceholder: 'e.g., 1, 5, 12',
                bitrixTaskTitle: 'Task Title Template',
                bitrixTaskTitlePlaceholder: 'Check prep center operation before {holiday}',
                bitrixTaskDescription: 'Task Description',
                bitrixTaskDescriptionPlaceholder: 'Please verify prep center is ready for the upcoming holiday',
                bitrixUpcoming: 'Upcoming Holidays (next 7 days)',
                bitrixNoUpcoming: 'No holidays in the next 7 days',
                bitrixDaysUntil: 'in {days} days',
                bitrixCreateTasks: 'Create Tasks in Bitrix24',
                bitrixSaveSettings: 'Save Settings',
                bitrixTestConnection: 'Test Connection',
                bitrixTasksCreated: 'Tasks created successfully!',
                bitrixTasksError: 'Error creating tasks',
                bitrixConnectionSuccess: 'Connection successful!',
                bitrixConnectionError: 'Connection failed',
                bitrixSettingsSaved: 'Settings saved',
                months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                weekdays: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                countryNames: {
                    'DE': 'Germany',
                    'PL': 'Poland',
                    'ES': 'Spain',
                    'GB': 'United Kingdom',
                    'CN': 'China',
                    'IT': 'Italy',
                    'FR': 'France'
                }
            },
            ru: {
                title: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ü—Ä–∞–∑–¥–Ω–∏–∫–æ–≤',
                subtitle: '–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –≤ 7 —Å—Ç—Ä–∞–Ω–∞—Ö',
                selectYear: '–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥',
                selectCountries: '–í—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞–Ω—ã',
                selectAll: '‚úì –í—ã–±—Ä–∞—Ç—å –≤—Å–µ',
                clear: '‚úó –û—á–∏—Å—Ç–∏—Ç—å',
                calendarView: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å',
                listView: '–°–ø–∏—Å–æ–∫',
                searchPlaceholder: '–ü–æ–∏—Å–∫ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤...',
                close: '–ó–∞–∫—Ä—ã—Ç—å',
                legend: '–õ–µ–≥–µ–Ω–¥–∞ —Å—Ç—Ä–∞–Ω',
                statistics: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤',
                totalHolidays: '–í—Å–µ–≥–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤',
                days: '–¥–Ω–µ–π',
                emptyStateTitle: '–°—Ç—Ä–∞–Ω—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã',
                emptyStateText: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—ã –≤—ã—à–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Ö –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤',
                bitrixTitle: '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–∏—Ç—Ä–∏–∫—Å24',
                bitrixWebhook: 'Webhook URL –ë–∏—Ç—Ä–∏–∫—Å24',
                bitrixWebhookPlaceholder: 'https://–≤–∞—à-–¥–æ–º–µ–Ω.bitrix24.ru/rest/1/xxxxx/',
                bitrixUsers: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)',
                bitrixUsersPlaceholder: '–Ω–∞–ø—Ä–∏–º–µ—Ä: 1, 5, 12',
                bitrixTaskTitle: '–®–∞–±–ª–æ–Ω –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏',
                bitrixTaskTitlePlaceholder: '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–µ–ø-—Ü–µ–Ω—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ {holiday}',
                bitrixTaskDescription: '–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏',
                bitrixTaskDescriptionPlaceholder: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–µ–ø-—Ü–µ–Ω—Ç—Ä–∞ –∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–º—É –ø—Ä–∞–∑–¥–Ω–∏–∫—É',
                bitrixUpcoming: '–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ (7 –¥–Ω–µ–π)',
                bitrixNoUpcoming: '–ù–µ—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π',
                bitrixDaysUntil: '—á–µ—Ä–µ–∑ {days} –¥–Ω.',
                bitrixCreateTasks: '–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ –ë–∏—Ç—Ä–∏–∫—Å24',
                bitrixSaveSettings: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏',
                bitrixTestConnection: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ',
                bitrixTasksCreated: '–ó–∞–¥–∞—á–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!',
                bitrixTasksError: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á',
                bitrixConnectionSuccess: '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!',
                bitrixConnectionError: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è',
                bitrixSettingsSaved: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',
                months: ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'],
                weekdays: ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'],
                countryNames: {
                    'DE': '–ì–µ—Ä–º–∞–Ω–∏—è',
                    'PL': '–ü–æ–ª—å—à–∞',
                    'ES': '–ò—Å–ø–∞–Ω–∏—è',
                    'GB': '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è',
                    'CN': '–ö–∏—Ç–∞–π',
                    'IT': '–ò—Ç–∞–ª–∏—è',
                    'FR': '–§—Ä–∞–Ω—Ü–∏—è'
                }
            }
        };

        // Country configuration
        const getCountries = (lang) => [
            { code: 'DE', name: translations[lang].countryNames['DE'], localName: 'Deutschland', color: '#0077B6', flag: 'üá©üá™' },
            { code: 'PL', name: translations[lang].countryNames['PL'], localName: 'Polska', color: '#FF0000', flag: 'üáµüá±' },
            { code: 'ES', name: translations[lang].countryNames['ES'], localName: 'Espa√±a', color: '#FFC300', flag: 'üá™üá∏' },
            { code: 'GB', name: translations[lang].countryNames['GB'], localName: 'United Kingdom', color: '#8A2BE2', flag: 'üá¨üáß' },
            { code: 'CN', name: translations[lang].countryNames['CN'], localName: '‰∏≠ÂõΩ', color: '#FF4500', flag: 'üá®üá≥' },
            { code: 'IT', name: translations[lang].countryNames['IT'], localName: 'Italia', color: '#008000', flag: 'üáÆüáπ' },
            { code: 'FR', name: translations[lang].countryNames['FR'], localName: 'France', color: '#4169E1', flag: 'üá´üá∑' }
        ];

        // Years for the dropdown
        const YEARS = Array.from({ length: 2035 - 2023 + 1 }, (_, i) => 2023 + i);

        // --- Holiday Data Generation ---
        const calculateEaster = (year) => {
            const a = year % 19;
            const b = Math.floor(year / 100);
            const c = year % 100;
            const d = Math.floor(b / 4);
            const e = b % 4;
            const f = Math.floor((b + 8) / 25);
            const g = Math.floor((b - f + 1) / 3);
            const h = (19 * a + b - d - g + 15) % 30;
            const i = Math.floor(c / 4);
            const k = c % 4;
            const l = (32 + 2 * e + 2 * i - h - k) % 7;
            const m = Math.floor((a + 11 * h + 22 * l) / 451);
            const month = Math.floor((h + l - 7 * m + 114) / 31);
            const day = ((h + l - 7 * m + 114) % 31) + 1;
            return new Date(year, month - 1, day);
        };

        const generateHolidays = (year) => {
            const easter = calculateEaster(year);
            const holidays = [];

            const addHoliday = (countryCode, name, localName, month, day) => {
                holidays.push({ countryCode, name, localName, date: `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}` });
            };

            const addRelativeHoliday = (countryCode, name, localName, baseDate, daysOffset) => {
                const date = new Date(baseDate);
                date.setDate(date.getDate() + daysOffset);
                addHoliday(countryCode, name, localName, date.getMonth() + 1, date.getDate());
            };

            // Fixed holidays
            // Fixed holidays
           // DE, PL, ES, IT, FR, GB\n            
            addHoliday('DE', 'New Year\'s Day', 'Neujahr', 1, 1);
            addHoliday('PL', 'New Year\'s Day', 'Nowy Rok', 1, 1);
            addHoliday('ES', 'New Year\'s Day', 'A√±o Nuevo', 1, 1);
                       addHoliday('IT', 'New Year\'s Day', 'Capodanno', 1, 1);
            addHoliday('FR', 'New Year\'s Day', 'Jour de l\'an', 1, 1);
            addHoliday('GB', 'New Year\'s Day', 'New Year\'s Day', 1, 1);
            addHoliday('CN', 'New Year\'s Day', 'ÂÖÉÊó¶', 1, 1);

            // CN - Labour Day
            addHoliday('CN', 'Labour Day', 'Âä≥Âä®ËäÇ', 5, 1);

            // DE, PL, IT, ES
            addHoliday('DE', 'Epiphany', 'Heilige Drei K√∂nige', 1, 6);
            addHoliday('PL', 'Epiphany', 'Trzech Kr√≥li', 1, 6);
            addHoliday('ES', 'Epiphany', 'D√≠a de los Reyes Magos', 1, 6);
            addHoliday('IT', 'Epiphany', 'Epifania', 1, 6);

            // DE, PL, ES, FR
            addHoliday('DE', 'Labour Day', 'Tag der Arbeit', 5, 1);
            addHoliday('PL', 'Labour Day', '≈öwiƒôto Pracy', 5, 1);
            addHoliday('ES', 'Labour Day', 'D√≠a del Trabajador', 5, 1);
            addHoliday('FR', 'Labour Day', 'F√™te du Travail', 5, 1);

            addHoliday('PL', 'Constitution Day', '≈öwiƒôto Konstytucji 3 Maja', 5, 3);
            addHoliday('FR', 'Victory in Europe Day', 'Victoire 1945', 5, 8);
            addHoliday('FR', 'Bastille Day', 'F√™te Nationale', 7, 14);

          // DE, IT, FR\n
            addHoliday('DE', 'Assumption of Mary', 'Mari√§ Himmelfahrt', 8, 15);
          
            addHoliday('IT', 'Assumption of Mary', 'Assunzione di Maria', 8, 15);
            addHoliday('FR', 'Assumption of Mary', 'Assomption', 8, 15);

            // IT specific fixed holidays
            addHoliday('IT', 'Liberation Day', 'Festa della Liberazione', 4, 25);
            addHoliday('IT', 'Republic Day', 'Festa della Repubblica', 6, 2);

            addHoliday('PL', 'Assumption of Mary', 'Wniebowziƒôcie Naj≈õwiƒôtszej Maryi Panny', 8, 15);
            addHoliday('DE', 'German Unity Day', 'Tag der Deutschen Einheit', 10, 3);
            addHoliday('ES', 'Hispanic Day', 'Fiesta Nacional de Espa√±a', 10, 12);
            addHoliday('DE', 'Reformation Day', 'Reformationstag', 10, 31);
           
          // DE, PL, IT\n, FR
            addHoliday('DE', 'All Saints\' Day', 'Allerheiligen', 11, 1);
            addHoliday('PL', 'All Saints\' Day', 'Wszystkich ≈öwiƒôtych', 11, 1);
          
            addHoliday('IT', 'All Saints\' Day', 'Tutti i Santi', 11, 1);
            addHoliday('FR', 'All Saints\' Day', 'Toussaint', 11, 1);

            addHoliday('PL', 'Independence Day', 'Narodowe ≈öwiƒôto Niepodleg≈Ço≈õci', 11, 11);
            addHoliday('FR', 'Armistice Day', 'Armistice 1918', 11, 11);
            addHoliday('ES', 'Constitution Day', 'D√≠a de la Constituci√≥n', 12, 6);

            // IT, ES\n         
            addHoliday('IT', 'Immaculate Conception', 'Immacolata Concezione', 12, 8);
            addHoliday('ES', 'Immaculate Conception', 'Inmaculada Concepci√≥n', 12, 8);

            /// DE, PL, IT, FR\nR, GB
            addHoliday('DE', 'Christmas Day', '1. Weihnachtstag', 12, 25);
            addHoliday('PL', 'Christmas Day', 'Bo≈ºe Narodzenie', 12, 25);
            addHoliday('ES', 'Christmas Day', 'Navidad', 12, 25);
                       addHoliday('IT', 'Christmas Day', 'Natale', 12, 25);
            addHoliday('FR', 'Christmas Day', 'No√´l', 12, 25);
            addHoliday('GB', 'Christmas Day', 'Christmas Day', 12, 25);

           // DE, PL, IT, GB\n            
            addHoliday('DE', 'St. Stephen\'s Day', '2. Weihnachtstag', 12, 26);
            addHoliday('PL', 'St. Stephen\'s Day', 'Drugi dzie≈Ñ ≈öwiƒÖt', 12, 26);
          
            addHoliday('IT', 'St. Stephen\'s Day', 'Santo Stefano', 12, 26);
            addHoliday('GB', 'Boxing Day', 'Boxing Day', 12, 26);

            // Easter related holidays
           // Easter Sunday (PL, IT, FR, ES - not a public holiday in DE/GB, but the base for others)\n            
            addRelativeHoliday('PL', 'Easter Sunday', 'Wielkanoc', easter, 0);
            addRelativeHoliday('IT', 'Easter Sunday', 'Pasqua', easter, 0);
          
            addRelativeHoliday('FR', 'Easter Sunday', 'P√¢ques', easter, 0);
            addRelativeHoliday('ES', 'Easter Sunday', 'Domingo de Resurrecci√≥n', easter, 0);

            // ES - Maundy Thursday
            addRelativeHoliday('ES', 'Maundy Thursday', 'Jueves Santo', easter, -3);

            // DE, PL, ES, GB, IT, FR
            addRelativeHoliday('DE', 'Good Friday', 'Karfreitag', easter, -2);
            addRelativeHoliday('ES', 'Good Friday', 'Viernes Santo', easter, -2);
            addRelativeHoliday('GB', 'Good Friday', 'Good Friday', easter, -2);

            // DE, PL, GB, IT, FR
            addRelativeHoliday('DE', 'Easter Monday', 'Ostermontag', easter, 1);
            addRelativeHoliday('PL', 'Easter Monday', 'Poniedzia≈Çek Wielkanocny', easter, 1);
            addRelativeHoliday('GB', 'Easter Monday', 'Easter Monday', easter, 1);
            addRelativeHoliday('IT', 'Easter Monday', 'Luned√¨ dell\'Angelo', easter, 1);
            addRelativeHoliday('FR', 'Easter Monday', 'Lundi de P√¢ques', easter, 1);

            // DE, FR
            addRelativeHoliday('DE', 'Ascension Day', 'Christi Himmelfahrt', easter, 39);
            addRelativeHoliday('FR', 'Ascension Day', 'Ascension', easter, 39);

            // DE, PL, FR
            addRelativeHoliday('DE', 'Whit Monday', 'Pfingstmontag', easter, 50);
            addRelativeHoliday('PL', 'Pentecost', 'Zes≈Çanie Ducha ≈öwiƒôtego', easter, 49);
                       addRelativeHoliday('FR', 'Whit Monday', 'Lundi de Pentec√¥te', easter, 50);

            // DE, PL
            addRelativeHoliday('DE', 'Corpus Christi', 'Fronleichnam', easter, 60);
            addRelativeHoliday('PL', 'Corpus Christi', 'Bo≈ºe Cia≈Ço', easter, 60);


            // IT - Labour Day (May 1st)
            addHoliday('IT', 'Labour Day', 'Festa del Lavoro', 5, 1);
            // ES - Assumption of Mary
            addHoliday('ES', 'Assumption of Mary', 'Asunci√≥n de Mar√≠a', 8, 15);
            // ES - All Saints' Day
            addHoliday('ES', 'All Saints\' Day', 'D√≠a de Todos los Santos', 11, 1);
                                
                     
                                
                     

            // UK specific (England and Wales) - Variable Bank Holidays
            const ukVariableHolidays = {
                2026: [{ m: 5, d: 4, name: 'Early May Bank Holiday' }, { m: 5, d: 25, name: 'Spring Bank Holiday' }, { m: 8, d: 31, name: 'Summer Bank Holiday' }],
                2027: [{ m: 5, d: 3, name: 'Early May Bank Holiday' }, { m: 5, d: 31, name: 'Spring Bank Holiday' }, { m: 8, d: 30, name: 'Summer Bank Holiday' }],
                2028: [{ m: 5, d: 1, name: 'Early May Bank Holiday' }, { m: 5, d: 29, name: 'Spring Bank Holiday' }, { m: 8, d: 28, name: 'Summer Bank Holiday' }],
                2029: [{ m: 5, d: 7, name: 'Early May Bank Holiday' }, { m: 5, d: 28, name: 'Spring Bank Holiday' }, { m: 8, d: 27, name: 'Summer Bank Holiday' }],
                2030: [{ m: 5, d: 6, name: 'Early May Bank Holiday' }, { m: 5, d: 27, name: 'Spring Bank Holiday' }, { m: 8, d: 26, name: 'Summer Bank Holiday' }],
                2031: [{ m: 5, d: 5, name: 'Early May Bank Holiday' }, { m: 5, d: 26, name: 'Spring Bank Holiday' }, { m: 8, d: 25, name: 'Summer Bank Holiday' }],
                2032: [{ m: 5, d: 3, name: 'Early May Bank Holiday' }, { m: 5, d: 31, name: 'Spring Bank Holiday' }, { m: 8, d: 30, name: 'Summer Bank Holiday' }],
                2033: [{ m: 5, d: 2, name: 'Early May Bank Holiday' }, { m: 5, d: 30, name: 'Spring Bank Holiday' }, { m: 8, d: 29, name: 'Summer Bank Holiday' }],
                2034: [{ m: 5, d: 1, name: 'Early May Bank Holiday' }, { m: 5, d: 29, name: 'Spring Bank Holiday' }, { m: 8, d: 28, name: 'Summer Bank Holiday' }],
                2035: [{ m: 5, d: 7, name: 'Early May Bank Holiday' }, { m: 5, d: 28, name: 'Spring Bank Holiday' }, { m: 8, d: 27, name: 'Summer Bank Holiday' }],
            };
            if (ukVariableHolidays[year]) {
                ukVariableHolidays[year].forEach(h => addHoliday('GB', h.name, h.name, h.m, h.d));
            }

            // China specific (Lunar-based holidays - precise Gregorian dates 2026-2035)
            const chinaLunarHolidays = {
                2026: { cny: '02-17', qmf: '04-05', dbf: '06-19', maf: '09-25' },
                2027: { cny: '02-06', qmf: '04-05', dbf: '06-09', maf: '09-15' },
                2028: { cny: '01-26', qmf: '04-04', dbf: '05-28', maf: '10-03' },
                2029: { cny: '02-13', qmf: '04-05', dbf: '06-16', maf: '09-22' },
                2030: { cny: '02-03', qmf: '04-05', dbf: '06-05', maf: '09-12' },
                2031: { cny: '01-23', qmf: '04-05', dbf: '06-24', maf: '10-01' },
                2032: { cny: '02-11', qmf: '04-04', dbf: '06-12', maf: '09-19' },
                2033: { cny: '01-31', qmf: '04-05', dbf: '06-01', maf: '09-08' },
                2034: { cny: '02-19', qmf: '04-05', dbf: '06-20', maf: '09-27' },
                2035: { cny: '02-08', qmf: '04-05', dbf: '06-10', maf: '09-16' },
            };

            if (chinaLunarHolidays[year]) {
                const h = chinaLunarHolidays[year];
                const parseDate = (dateStr) => dateStr.split('-').map(Number);

                let [m_cny, d_cny] = parseDate(h.cny);
                addHoliday('CN', 'Chinese New Year', 'Êò•ËäÇ', m_cny, d_cny);

                let [m_qmf, d_qmf] = parseDate(h.qmf);
                addHoliday('CN', 'Qingming Festival', 'Ê∏ÖÊòéËäÇ', m_qmf, d_qmf);

                let [m_dbf, d_dbf] = parseDate(h.dbf);
                addHoliday('CN', 'Dragon Boat Festival', 'Á´ØÂçàËäÇ', m_dbf, d_dbf);

                let [m_maf, d_maf] = parseDate(h.maf);
                addHoliday('CN', 'Mid-Autumn Festival', '‰∏≠ÁßãËäÇ', m_maf, d_maf);
            }
            addHoliday('CN', 'National Day', 'ÂõΩÂ∫ÜËäÇ', 10, 1);

            return holidays;
        };

        const ALL_HOLIDAYS = YEARS.flatMap(generateHolidays);

        // Main App Component
        function HolidayCalendarApp() {
            const [language, setLanguage] = useState('en'); // 'en' or 'ru'
            const [darkTheme, setDarkTheme] = useState(false);
            const t = translations[language];
            const COUNTRIES = getCountries(language);

            const [selectedYear, setSelectedYear] = useState(2026); // –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω 2026 –≥–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const [selectedCountries, setSelectedCountries] = useState([]); // –£–±—Ä–∞–Ω –≤—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const [viewMode, setViewMode] = useState('calendar'); // 'calendar' or 'list'
            const [selectedDay, setSelectedDay] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [showCountryDropdown, setShowCountryDropdown] = useState(false);

            // Bitrix24 integration state
            const [bitrixWebhook, setBitrixWebhook] = useState(localStorage.getItem('bitrixWebhook') || '');
            const [bitrixUsers, setBitrixUsers] = useState(() => {
                try {
                    const saved = localStorage.getItem('bitrixUsers') || '';
                    // Validate that saved value contains only numbers and commas
                    if (saved && /^[\d,\s]+$/.test(saved)) {
                        return saved.split(',').map(id => id.trim()).filter(id => id && /^\d+$/.test(id));
                    }
                    return [];
                } catch (e) {
                    return [];
                }
            });
            const [bitrixUserInput, setBitrixUserInput] = useState('');
            const [bitrixTaskTitle, setBitrixTaskTitle] = useState(localStorage.getItem('bitrixTaskTitle') || t.bitrixTaskTitlePlaceholder);
            const [bitrixTaskDescription, setBitrixTaskDescription] = useState(localStorage.getItem('bitrixTaskDescription') || t.bitrixTaskDescriptionPlaceholder);
            const [bitrixNotification, setBitrixNotification] = useState(null);
            const [showBitrixModal, setShowBitrixModal] = useState(false);

            // Apply dark theme
            useEffect(() => {
                if (darkTheme) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }
            }, [darkTheme]);

            // Clean up invalid localStorage data on mount
            useEffect(() => {
                const saved = localStorage.getItem('bitrixUsers') || '';
                // If saved data contains invalid characters, clear it
                if (saved && !/^[\d,\s]*$/.test(saved)) {
                    localStorage.setItem('bitrixUsers', '');
                }
            }, []);

            // Auto-save Bitrix24 settings to localStorage
            useEffect(() => {
                localStorage.setItem('bitrixWebhook', bitrixWebhook);
            }, [bitrixWebhook]);

            useEffect(() => {
                localStorage.setItem('bitrixUsers', bitrixUsers.join(','));
            }, [bitrixUsers]);

            useEffect(() => {
                localStorage.setItem('bitrixTaskTitle', bitrixTaskTitle);
            }, [bitrixTaskTitle]);

            useEffect(() => {
                localStorage.setItem('bitrixTaskDescription', bitrixTaskDescription);
            }, [bitrixTaskDescription]);

            // Filter holidays by year and selected countries
            const filteredHolidays = useMemo(() => {
                return ALL_HOLIDAYS.filter(h => {
                    const holidayYear = parseInt(h.date.split('-')[0]);
                    return holidayYear === selectedYear && selectedCountries.includes(h.countryCode);
                });
            }, [selectedYear, selectedCountries]);

            // Group holidays by date for calendar view
            const holidaysByDate = useMemo(() => {
                return filteredHolidays.reduce((acc, holiday) => {
                    if (!acc[holiday.date]) {
                        acc[holiday.date] = [];
                    }
                    acc[holiday.date].push(holiday);
                    return acc;
                }, {});
            }, [filteredHolidays]);

            const toggleCountry = (countryCode) => {
                setSelectedCountries(prev =>
                    prev.includes(countryCode)
                        ? prev.filter(c => c !== countryCode)
                        : [...prev, countryCode]
                );
            };

            const selectAllCountries = () => {
                setSelectedCountries(COUNTRIES.map(c => c.code));
            };

            const deselectAllCountries = () => {
                setSelectedCountries([]);
            };

            // Calculate statistics
            const holidayStats = useMemo(() => {
                const stats = {};
                selectedCountries.forEach(code => {
                    const count = filteredHolidays.filter(h => h.countryCode === code).length;
                    stats[code] = count;
                });
                return stats;
            }, [filteredHolidays, selectedCountries]);

            const totalHolidays = useMemo(() => {
                return filteredHolidays.length;
            }, [filteredHolidays]);

            // Get upcoming holidays (within 7 days)
            const upcomingHolidays = useMemo(() => {
                const today = new Date();
                const sevenDaysLater = new Date(today);
                sevenDaysLater.setDate(today.getDate() + 7);

                return filteredHolidays.filter(holiday => {
                    const holidayDate = new Date(holiday.date);
                    return holidayDate >= today && holidayDate <= sevenDaysLater;
                }).sort((a, b) => a.date.localeCompare(b.date));
            }, [filteredHolidays]);

            // Add user to list
            const addBitrixUser = () => {
                if (!bitrixUserInput.trim()) return;

                // Parse comma-separated input - only accept numbers
                const newUsers = bitrixUserInput.split(',')
                    .map(id => id.trim())
                    .filter(id => id && /^\d+$/.test(id) && !bitrixUsers.includes(id));

                if (newUsers.length > 0) {
                    setBitrixUsers([...bitrixUsers, ...newUsers]);
                    setBitrixUserInput('');
                }
            };

            // Remove user from list
            const removeBitrixUser = (userId) => {
                setBitrixUsers(bitrixUsers.filter(id => id !== userId));
            };

            // Test Bitrix24 connection
            const testBitrixConnection = async () => {
                if (!bitrixWebhook) {
                    showBitrixNotification('error', t.bitrixConnectionError);
                    return;
                }

                try {
                    const response = await fetch(`${bitrixWebhook}user.current`, {
                        method: 'GET'
                    });

                    if (response.ok) {
                        showBitrixNotification('success', t.bitrixConnectionSuccess);
                    } else {
                        showBitrixNotification('error', t.bitrixConnectionError);
                    }
                } catch (error) {
                    showBitrixNotification('error', t.bitrixConnectionError + ': ' + error.message);
                }
            };

            // Create tasks in Bitrix24
            const createBitrixTasks = async () => {
                if (!bitrixWebhook || bitrixUsers.length === 0 || upcomingHolidays.length === 0) {
                    showBitrixNotification('error', t.bitrixTasksError);
                    return;
                }

                let tasksCreated = 0;
                let tasksFailed = 0;

                for (const holiday of upcomingHolidays) {
                    const country = COUNTRIES.find(c => c.code === holiday.countryCode);
                    const holidayDate = new Date(holiday.date);
                    const daysUntil = Math.ceil((holidayDate - new Date()) / (1000 * 60 * 60 * 24));

                    const title = bitrixTaskTitle.replace('{holiday}', `${holiday.name} (${country?.name || holiday.countryCode})`);
                    const description = bitrixTaskDescription + `\n\n` +
                        `–ü—Ä–∞–∑–¥–Ω–∏–∫: ${holiday.name} (${holiday.localName})\n` +
                        `–°—Ç—Ä–∞–Ω–∞: ${country?.flag} ${country?.name}\n` +
                        `–î–∞—Ç–∞: ${holiday.date}\n` +
                        `–î–Ω–µ–π –¥–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞: ${daysUntil}`;

                    for (const userId of bitrixUsers) {
                        try {
                            const taskData = {
                                fields: {
                                    TITLE: title,
                                    DESCRIPTION: description,
                                    RESPONSIBLE_ID: userId,
                                    DEADLINE: holiday.date,
                                    PRIORITY: '2' // High priority
                                }
                            };

                            const response = await fetch(`${bitrixWebhook}tasks.task.add`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(taskData)
                            });

                            if (response.ok) {
                                tasksCreated++;
                            } else {
                                tasksFailed++;
                            }
                        } catch (error) {
                            tasksFailed++;
                        }
                    }
                }

                if (tasksCreated > 0) {
                    showBitrixNotification('success', `${t.bitrixTasksCreated} (${tasksCreated})`);
                } else {
                    showBitrixNotification('error', t.bitrixTasksError);
                }
            };

            // Show notification
            const showBitrixNotification = (type, message) => {
                setBitrixNotification({ type, message });
                setTimeout(() => setBitrixNotification(null), 5000);
            };

            return (
                <div className="app-container">
                    <header className="header">
                        <h1>{t.title}</h1>
                        <p>{t.subtitle}</p>
                        <div style={{ marginTop: '10px', display: 'flex', gap: '10px', justifyContent: 'center' }}>
                            <button onClick={() => setLanguage('ru')} className={`btn ${language === 'ru' ? 'btn-primary' : 'btn-secondary'}`}>–†—É—Å—Å–∫–∏–π</button>
                            <button onClick={() => setLanguage('en')} className={`btn ${language === 'en' ? 'btn-primary' : 'btn-secondary'}`}>English</button>
                        </div>
                    </header>

                    {/* Legend */}
                    <div className="legend-container">
                        <div className="legend-title">üé® {t.legend}</div>
                        <div className="legend-grid">
                            {COUNTRIES.map(country => (
                                <div key={country.code} className="legend-item">
                                    <span className="legend-flag">{country.flag}</span>
                                    <div className="legend-color" style={{ backgroundColor: country.color }}></div>
                                    <span className="legend-name">{country.name}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="controls">
                        <div className="select-wrapper">
                            <select value={selectedYear} onChange={e => setSelectedYear(parseInt(e.target.value))} aria-label={t.selectYear}>
                                {YEARS.map(year => <option key={year} value={year}>{year}</option>)}
                            </select>
                        </div>
                        <div className="relative inline-block text-left">
                            <button
                                type="button"
                                className="btn btn-primary"
                                onClick={() => setShowCountryDropdown(!showCountryDropdown)}
                            >
                                {t.selectCountries}
                            </button>
                            {showCountryDropdown && (
                                <div className="country-dropdown">
                                    <div className="country-dropdown-header">
                                        <button className="btn btn-secondary" onClick={selectAllCountries}>{t.selectAll}</button>
                                        <button className="btn btn-secondary" onClick={deselectAllCountries}>{t.clear}</button>
                                    </div>
                                    {COUNTRIES.map(country => (
                                        <div key={country.code} className="country-dropdown-item" onClick={() => toggleCountry(country.code)}>
                                            <input type="checkbox" readOnly checked={selectedCountries.includes(country.code)} />
                                            <span style={{ fontSize: '1.2rem' }}>{country.flag}</span>
                                            <span style={{ color: country.color, fontWeight: 'bold' }}>‚ñ†</span>
                                            <span>{country.name}</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="country-chips">
                        {selectedCountries.map(code => {
                            const country = COUNTRIES.find(c => c.code === code);
                            const count = holidayStats[code] || 0;
                            return (
                                <div key={code} className="chip" style={{ backgroundColor: country.color, color: 'white' }}>
                                    <span>{country.flag} {country.name}</span>
                                    <span className="chip-counter">({count})</span>
                                    <button className="chip-close" onClick={() => toggleCountry(code)}>√ó</button>
                                </div>
                            );
                        })}
                    </div>

                    {/* Statistics */}
                    {selectedCountries.length > 0 && (
                        <div className="stats-container">
                            <div className="stats-title">üìä {t.statistics} {selectedYear}</div>
                            <div className="stats-total">{totalHolidays} {t.totalHolidays}</div>
                            <div className="stats-grid">
                                {selectedCountries.map(code => {
                                    const country = COUNTRIES.find(c => c.code === code);
                                    const count = holidayStats[code] || 0;
                                    return (
                                        <div key={code} className="stats-item">
                                            <div className="stats-country">
                                                <span style={{ fontSize: '1.2rem' }}>{country.flag}</span>
                                                <span>{country.name}</span>
                                            </div>
                                            <div className="stats-count">{count} {t.days}</div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* Bitrix24 Floating Button */}
                    {selectedCountries.length > 0 && (
                        <button
                            className="bitrix-float-button"
                            onClick={() => setShowBitrixModal(true)}
                            title={t.bitrixTitle}
                        >
                            üìã
                            {upcomingHolidays.length > 0 && (
                                <span className="badge">{upcomingHolidays.length}</span>
                            )}
                        </button>
                    )}

                    {/* Bitrix24 Modal */}
                    {showBitrixModal && (
                        <div className="bitrix-modal-overlay" onClick={() => setShowBitrixModal(false)}>
                            <div className="bitrix-modal" onClick={(e) => e.stopPropagation()}>
                                <div className="bitrix-header">
                                    <div className="bitrix-title">
                                        <span>üìã</span> {t.bitrixTitle}
                                    </div>
                                    <button className="modal-close" onClick={() => setShowBitrixModal(false)} title={t.close}>√ó</button>
                                </div>

                                <div className="bitrix-form">
                                <div className="bitrix-input-group">
                                    <label className="bitrix-label">{t.bitrixWebhook}</label>
                                    <input
                                        type="text"
                                        className="bitrix-input"
                                        placeholder={t.bitrixWebhookPlaceholder}
                                        value={bitrixWebhook}
                                        onChange={(e) => setBitrixWebhook(e.target.value)}
                                    />
                                </div>

                                <div className="bitrix-input-group">
                                    <label className="bitrix-label">{t.bitrixUsers} {bitrixUsers.length > 0 && `(${bitrixUsers.length})`}</label>
                                    <div className="bitrix-input-with-button">
                                        <input
                                            type="text"
                                            className="bitrix-input"
                                            placeholder={t.bitrixUsersPlaceholder}
                                            value={bitrixUserInput}
                                            onChange={(e) => {
                                                // Only allow numbers, commas and spaces
                                                const value = e.target.value.replace(/[^\d,\s]/g, '');
                                                setBitrixUserInput(value);
                                            }}
                                            onKeyPress={(e) => e.key === 'Enter' && addBitrixUser()}
                                        />
                                        <button
                                            className="bitrix-add-button"
                                            onClick={addBitrixUser}
                                        >
                                            + –î–æ–±–∞–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    {bitrixUsers.length > 0 && (
                                        <div className="bitrix-users-chips">
                                            {bitrixUsers.map((userId) => (
                                                <div key={userId} className="bitrix-user-chip">
                                                    <span>üë§ {userId}</span>
                                                    <button
                                                        className="bitrix-user-chip-close"
                                                        onClick={() => removeBitrixUser(userId)}
                                                        title="–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                                                    >
                                                        √ó
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="bitrix-input-group">
                                    <label className="bitrix-label">{t.bitrixTaskTitle}</label>
                                    <input
                                        type="text"
                                        className="bitrix-input"
                                        placeholder={t.bitrixTaskTitlePlaceholder}
                                        value={bitrixTaskTitle}
                                        onChange={(e) => setBitrixTaskTitle(e.target.value)}
                                    />
                                </div>

                                <div className="bitrix-input-group">
                                    <label className="bitrix-label">{t.bitrixTaskDescription}</label>
                                    <textarea
                                        className="bitrix-input bitrix-textarea"
                                        placeholder={t.bitrixTaskDescriptionPlaceholder}
                                        value={bitrixTaskDescription}
                                        onChange={(e) => setBitrixTaskDescription(e.target.value)}
                                    />
                                </div>

                                {/* Upcoming Holidays */}
                                <div className="bitrix-upcoming-holidays">
                                    <div className="bitrix-upcoming-title">
                                        ‚è∞ {t.bitrixUpcoming}
                                    </div>
                                    {upcomingHolidays.length > 0 ? (
                                        upcomingHolidays.map((holiday, index) => {
                                            const country = COUNTRIES.find(c => c.code === holiday.countryCode);
                                            const holidayDate = new Date(holiday.date);
                                            const today = new Date();
                                            const daysUntil = Math.ceil((holidayDate - today) / (1000 * 60 * 60 * 24));

                                            return (
                                                <div key={index} className="bitrix-holiday-item">
                                                    <div className="bitrix-holiday-info">
                                                        <div className="bitrix-holiday-name">
                                                            <span style={{ marginRight: '5px' }}>{country?.flag}</span>
                                                            {holiday.name}
                                                        </div>
                                                        <div className="bitrix-holiday-date">
                                                            {holiday.date} ‚Ä¢ {country?.name}
                                                        </div>
                                                    </div>
                                                    <div className={`bitrix-badge ${daysUntil <= 3 ? 'warning' : ''}`}>
                                                        {t.bitrixDaysUntil.replace('{days}', daysUntil)}
                                                    </div>
                                                </div>
                                            );
                                        })
                                    ) : (
                                        <div style={{ color: '#64748b', textAlign: 'center', padding: '10px' }}>
                                            {t.bitrixNoUpcoming}
                                        </div>
                                    )}
                                </div>

                                {/* Actions */}
                                <div className="bitrix-actions">
                                    <button className="btn btn-secondary" onClick={testBitrixConnection}>
                                        üîå {t.bitrixTestConnection}
                                    </button>
                                    <button
                                        className="btn btn-primary"
                                        onClick={createBitrixTasks}
                                        disabled={upcomingHolidays.length === 0}
                                    >
                                        ‚úÖ {t.bitrixCreateTasks} ({upcomingHolidays.length})
                                    </button>
                                </div>

                                {/* Notification */}
                                {bitrixNotification && (
                                    <div className={`bitrix-notification ${bitrixNotification.type}`}>
                                        <span>{bitrixNotification.type === 'success' ? '‚úÖ' : bitrixNotification.type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                                        <span>{bitrixNotification.message}</span>
                                    </div>
                                )}
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="calendar-container">
                        <div className="view-toggle">
                            <button
                                className={`btn ${viewMode === 'calendar' ? 'btn-primary' : 'btn-secondary'}`}
                                onClick={() => setViewMode('calendar')}
                            >
                                {t.calendarView}
                            </button>
                            <button
                                className={`btn ${viewMode === 'list' ? 'btn-primary' : 'btn-secondary'}`}
                                onClick={() => setViewMode('list')}
                            >
                                {t.listView}
                            </button>
                        </div>

                        {selectedCountries.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-state-icon">üìÖ</div>
                                <div className="empty-state-title">{t.emptyStateTitle}</div>
                                <div className="empty-state-text">{t.emptyStateText}</div>
                                <button className="btn btn-primary" onClick={() => setShowCountryDropdown(true)}>
                                    {t.selectCountries}
                                </button>
                            </div>
                        ) : viewMode === 'calendar' ? (
                            <CalendarView
                                year={selectedYear}
                                holidaysByDate={holidaysByDate}
                                onDayClick={setSelectedDay}
                                lang={language}
                            />
                        ) : (
                            <ListView
                                holidays={filteredHolidays}
                                searchQuery={searchQuery}
                                onSearchChange={setSearchQuery}
                                lang={language}
                            />
                        )}
                    </div>

                    {/* Theme Toggle */}
                    <button className="theme-toggle" onClick={() => setDarkTheme(!darkTheme)} title="Toggle theme">
                        {darkTheme ? '‚òÄÔ∏è' : 'üåô'}
                    </button>

                    {selectedDay && (
                        <DayModal
                            date={selectedDay}
                            holidays={holidaysByDate[selectedDay] || []}
                            onClose={() => setSelectedDay(null)}
                            lang={language}
                        />
                    )}
                </div>
            );
        }

        // Calendar View Component
        function CalendarView({ year, holidaysByDate, onDayClick, lang }) {
            const t = translations[lang];
            const COUNTRIES = getCountries(lang);
            const months = t.months;
            const weekdays = t.weekdays;

            const today = new Date();
            const isToday = (year, month, day) => {
                return today.getFullYear() === year &&
                       today.getMonth() === month &&
                       today.getDate() === day;
            };

            const getCellStyle = (holidays) => {
                if (!holidays || holidays.length === 0) return {};
                if (holidays.length === 1) {
                    const country = COUNTRIES.find(c => c.code === holidays[0].countryCode);
                    return { backgroundColor: country ? country.color : '#ccc', color: 'white' };
                }
                const colors = holidays.map(h => {
                    const country = COUNTRIES.find(c => c.code === h.countryCode);
                    return country ? country.color : '#ccc';
                });
                const uniqueColors = [...new Set(colors)];
                const stripeSize = 100 / uniqueColors.length;
                const gradient = uniqueColors.map((color, index) =>
                    `${color} ${index * stripeSize}%, ${color} ${(index + 1) * stripeSize}%`
                ).join(', ');
                return { background: `linear-gradient(to right, ${gradient})`, color: 'white' };
            };

            return (
                <div className="calendar-grid">
                    {months.map((monthName, monthIndex) => {
                        const firstDay = new Date(year, monthIndex, 1).getDay();
                        const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();
                        const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
                        const emptyDays = Array.from({ length: firstDay });

                        return (
                            <div key={monthIndex} className="month-block">
                                <div className="month-header">{monthName}</div>
                                <div className="weekdays">
                                    {weekdays.map(wd => <div key={wd} className="weekday">{wd}</div>)}
                                </div>
                                <div className="days-grid">
                                    {emptyDays.map((_, i) => <div key={`empty-${i}`} className="day-cell empty"></div>)}
                                    {days.map(day => {
                                        const dateStr = `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                        const holidays = holidaysByDate[dateStr] || [];
                                        const hasHoliday = holidays.length > 0;
                                        const style = getCellStyle(holidays);
                                        const dayOfWeek = new Date(year, monthIndex, day).getDay();
                                        const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                                        const isTodayCell = isToday(year, monthIndex, day);

                                        return (
                                            <div
                                                key={day}
                                                className={`day-cell ${hasHoliday ? 'has-holiday' : ''} ${isWeekend ? 'weekend' : ''} ${isTodayCell ? 'today' : ''}`}
                                                style={style}
                                                onClick={() => hasHoliday && onDayClick(dateStr)}
                                                title={hasHoliday ? holidays.map(h => `${h.name} (${(COUNTRIES.find(c => c.code === h.countryCode) || {}).name || h.countryCode})`).join('\n') : ''}
                                            >
                                                {day}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        }

        // List View Component
        function ListView({ holidays, searchQuery, onSearchChange, lang }) {
            const t = translations[lang];
            const COUNTRIES = getCountries(lang);

            const filteredHolidays = useMemo(() => {
                const query = searchQuery.toLowerCase();
                return holidays.filter(h => {
                    const country = COUNTRIES.find(c => c.code === h.countryCode);
                    return h.name.toLowerCase().includes(query) ||
                           h.localName.toLowerCase().includes(query) ||
                           (country && country.name.toLowerCase().includes(query));
                });
            }, [holidays, searchQuery, COUNTRIES]);

            // Group holidays by date and name
            const groupedHolidays = useMemo(() => {
                const groups = {};
                filteredHolidays.forEach(holiday => {
                    const key = `${holiday.date}-${holiday.name}`;
                    if (!groups[key]) {
                        groups[key] = {
                            date: holiday.date,
                            name: holiday.name,
                            countries: []
                        };
                    }
                    const country = COUNTRIES.find(c => c.code === holiday.countryCode);
                    if (country) {
                        groups[key].countries.push({
                            ...country,
                            localName: holiday.localName
                        });
                    }
                });
                return Object.values(groups).sort((a, b) => a.date.localeCompare(b.date));
            }, [filteredHolidays, COUNTRIES]);

            return (
                <div className="list-view-container">
                    <input
                        type="text"
                        className="search-box"
                        placeholder={t.searchPlaceholder}
                        value={searchQuery}
                        onChange={(e) => onSearchChange(e.target.value)}
                    />
                    <div>
                        {groupedHolidays.map((group, index) => (
                            <div key={index} className="list-group">
                                <div className="list-group-header">
                                    <span>üìÖ {group.date}</span>
                                    <span style={{ marginLeft: 'auto', fontWeight: 'normal' }}>{group.name}</span>
                                </div>
                                <div className="list-group-countries">
                                    {group.countries.map((country, idx) => (
                                        <div
                                            key={idx}
                                            className="list-group-country-badge"
                                            style={{ borderLeft: `3px solid ${country.color}` }}
                                        >
                                            <span style={{ marginRight: '5px' }}>{country.flag}</span>
                                            {country.name}
                                            <span style={{ marginLeft: '5px', color: '#64748b', fontSize: '0.8rem' }}>
                                                ({country.localName})
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Day Modal Component
        function DayModal({ date, holidays, onClose, lang }) {
            const t = translations[lang];
            const COUNTRIES = getCountries(lang);
            const dateObj = new Date(date);
            const month = t.months[dateObj.getMonth()];
            const day = dateObj.getDate();
            const year = dateObj.getFullYear();

            // Group by holiday name
            const groupedByName = useMemo(() => {
                const groups = {};
                holidays.forEach(holiday => {
                    if (!groups[holiday.name]) {
                        groups[holiday.name] = [];
                    }
                    const country = COUNTRIES.find(c => c.code === holiday.countryCode);
                    groups[holiday.name].push({
                        ...holiday,
                        country
                    });
                });
                return groups;
            }, [holidays, COUNTRIES]);

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">üìÖ {month} {day}, {year}</h2>
                            <button className="modal-close" onClick={onClose} title={t.close}>√ó</button>
                        </div>
                        <div>
                            {Object.entries(groupedByName).map(([name, items], index) => (
                                <div key={index} style={{ marginBottom: '20px' }}>
                                    <div style={{ fontSize: '1.2rem', fontWeight: 'bold', marginBottom: '10px', color: '#667eea' }}>
                                        üéä {name}
                                    </div>
                                    {items.map((item, idx) => (
                                        <div
                                            key={idx}
                                            className="holiday-item"
                                            style={{ borderLeft: `5px solid ${item.country ? item.country.color : '#ccc'}` }}
                                        >
                                            <div className="holiday-name">
                                                <span style={{ fontSize: '1.3rem', marginRight: '8px' }}>
                                                    {item.country ? item.country.flag : 'üè≥Ô∏è'}
                                                </span>
                                                {item.country ? item.country.name : item.countryCode}
                                            </div>
                                            <div className="holiday-local">‚îî‚îÄ {item.localName}</div>
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HolidayCalendarApp />);

    </script>
</body>
</html>
